<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ndb-core documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">ndb-core documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >EntityFormService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/entity-components/entity-form/entity-form.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>This service provides helper functions for creating tables or forms for an entity as well as saving
new changes correctly to the entity.</p>

            </p>



            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#createFormGroup" >createFormGroup</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#extendFormFieldConfig" >extendFormFieldConfig</a>
                            </li>
                            <li>
                                <a href="#resetForm" >resetForm</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#saveChanges" >saveChanges</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(fb: FormBuilder, entityMapper: <a href="../injectables/EntityMapperService.html" target="_self">EntityMapperService</a>, entitySchemaService: <a href="../injectables/EntitySchemaService.html" target="_self">EntitySchemaService</a>, dynamicValidator: <a href="../injectables/DynamicValidatorsService.html" target="_self">DynamicValidatorsService</a>, ability: <a href="../injectables/EntityAbility.html" target="_self">EntityAbility</a>, unsavedChanges: <a href="../injectables/UnsavedChangesService.html" target="_self">UnsavedChangesService</a>, session: <a href="../classes/SessionService.html" target="_self">SessionService</a>, router: Router)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="34" class="link-to-prism">src/app/core/entity-components/entity-form/entity-form.service.ts:34</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>fb</td>
                                                  
                                                        <td>
                                                                    <code>FormBuilder</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>entityMapper</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/EntityMapperService.html" target="_self" >EntityMapperService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>entitySchemaService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/EntitySchemaService.html" target="_self" >EntitySchemaService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>dynamicValidator</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DynamicValidatorsService.html" target="_self" >DynamicValidatorsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>ability</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/EntityAbility.html" target="_self" >EntityAbility</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>unsavedChanges</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UnsavedChangesService.html" target="_self" >UnsavedChangesService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>session</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/SessionService.html" target="_self" >SessionService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>router</td>
                                                  
                                                        <td>
                                                                    <code>Router</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createFormGroup"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>createFormGroup</b></span>
                        <a href="#createFormGroup"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createFormGroup(formFields: <a href="../interfaces/FormFieldConfig.html" target="_self">FormFieldConfig[]</a>, entity: T, forTable)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="113"
                            class="link-to-prism">src/app/core/entity-components/entity-form/entity-form.service.ts:113</a></div>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Type parameters :</b>
                    <ul class="type-parameters">
                        <li>T</li>
                    </ul>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Creates a FormGroups from the formFields and the existing values from the entity.
Missing fields in the formFields are filled with schema information.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>formFields</td>
                                    <td>
                                                <code><a href="../interfaces/FormFieldConfig.html" target="_self" >FormFieldConfig[]</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                            <code>T</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>forTable</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/Entity.html" target="_self" >EntityForm&lt;T&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="extendFormFieldConfig"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>extendFormFieldConfig</b></span>
                        <a href="#extendFormFieldConfig"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>extendFormFieldConfig(formFields: <a href="../interfaces/FormFieldConfig.html" target="_self">FormFieldConfig[]</a>, entityType: <a href="../undefineds/EntityConstructor.html" target="_self">EntityConstructor</a>, forTable)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="62"
                            class="link-to-prism">src/app/core/entity-components/entity-form/entity-form.service.ts:62</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Uses schema information to fill missing fields in the FormFieldConfig.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>formFields</td>
                                    <td>
                                                <code><a href="../interfaces/FormFieldConfig.html" target="_self" >FormFieldConfig[]</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>entityType</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityConstructor" target="_self" >EntityConstructor</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>forTable</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resetForm"></a>
                    <span class="name">
                        <span ><b>resetForm</b></span>
                        <a href="#resetForm"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>resetForm(form: <a href="../classes/Entity.html" target="_self">EntityForm&lt;E&gt;</a>, entity: E)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="217"
                            class="link-to-prism">src/app/core/entity-components/entity-form/entity-form.service.ts:217</a></div>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Type parameters :</b>
                    <ul class="type-parameters">
                        <li>E</li>
                    </ul>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>form</td>
                                    <td>
                                                <code><a href="../classes/Entity.html" target="_self" >EntityForm&lt;E&gt;</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                            <code>E</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="saveChanges"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>saveChanges</b></span>
                        <a href="#saveChanges"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>saveChanges(form: <a href="../classes/Entity.html" target="_self">EntityForm&lt;T&gt;</a>, entity: T)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="176"
                            class="link-to-prism">src/app/core/entity-components/entity-form/entity-form.service.ts:176</a></div>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Type parameters :</b>
                    <ul class="type-parameters">
                        <li>T</li>
                    </ul>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This function applies the changes of the formGroup to the entity.
If the form is invalid or the entity does not pass validation after applying the changes, an error will be thrown.
The input entity will not be modified but a copy of it will be returned in case of success.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>form</td>
                                    <td>
                                                <code><a href="../classes/Entity.html" target="_self" >EntityForm&lt;T&gt;</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>The formGroup holding the changes</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                            <code>T</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>The entity on which the changes should be applied.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;T&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>a copy of the input entity with the changes from the form group</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &quot;@angular/core&quot;;
import { FormBuilder, FormGroup, ɵElement } from &quot;@angular/forms&quot;;
import { FormFieldConfig } from &quot;./entity-form/FormConfig&quot;;
import { Entity, EntityConstructor } from &quot;../../entity/model/entity&quot;;
import { EntityMapperService } from &quot;../../entity/entity-mapper.service&quot;;
import { EntitySchemaService } from &quot;../../entity/schema/entity-schema.service&quot;;
import { DynamicValidatorsService } from &quot;./dynamic-form-validators/dynamic-validators.service&quot;;
import { EntityAbility } from &quot;../../permissions/ability/entity-ability&quot;;
import { InvalidFormFieldError } from &quot;./invalid-form-field.error&quot;;
import { omit } from &quot;lodash-es&quot;;
import { UnsavedChangesService } from &quot;../entity-details/form/unsaved-changes.service&quot;;
import { ActivationStart, Router } from &quot;@angular/router&quot;;
import { Subscription } from &quot;rxjs&quot;;
import { filter } from &quot;rxjs/operators&quot;;
import { SessionService } from &quot;../../session/session-service/session.service&quot;;
import {
  EntitySchemaField,
  PLACEHOLDERS,
} from &quot;../../entity/schema/entity-schema-field&quot;;
import { isArrayDataType } from &quot;../entity-utils/entity-utils&quot;;

/**
 * These are utility types that allow to define the type of &#x60;FormGroup&#x60; the way it is returned by &#x60;EntityFormService.create&#x60;
 */
export type TypedForm&lt;T&gt; &#x3D; FormGroup&lt;{ [K in keyof T]: ɵElement&lt;T[K], null&gt; }&gt;;
export type EntityForm&lt;T extends Entity&gt; &#x3D; TypedForm&lt;Partial&lt;T&gt;&gt;;

/**
 * This service provides helper functions for creating tables or forms for an entity as well as saving
 * new changes correctly to the entity.
 */
@Injectable({ providedIn: &quot;root&quot; })
export class EntityFormService {
  private subscriptions: Subscription[] &#x3D; [];

  constructor(
    private fb: FormBuilder,
    private entityMapper: EntityMapperService,
    private entitySchemaService: EntitySchemaService,
    private dynamicValidator: DynamicValidatorsService,
    private ability: EntityAbility,
    private unsavedChanges: UnsavedChangesService,
    private session: SessionService,
    router: Router
  ) {
    router.events
      .pipe(filter((e) &#x3D;&gt; e instanceof ActivationStart))
      .subscribe(() &#x3D;&gt; {
        // Clean up everything once navigation happens
        this.subscriptions.forEach((sub) &#x3D;&gt; sub.unsubscribe());
        this.subscriptions &#x3D; [];
        this.unsavedChanges.pending &#x3D; false;
      });
  }

  /**
   * Uses schema information to fill missing fields in the FormFieldConfig.
   * @param formFields
   * @param entityType
   * @param forTable
   */
  public extendFormFieldConfig(
    formFields: FormFieldConfig[],
    entityType: EntityConstructor,
    forTable &#x3D; false
  ) {
    formFields.forEach((formField) &#x3D;&gt; {
      try {
        this.addFormFields(formField, entityType, forTable);
      } catch (err) {
        throw new Error(
          &#x60;Could not create form config for ${formField.id}: ${err}&#x60;
        );
      }
    });
  }

  private addFormFields(
    formField: FormFieldConfig,
    entityType: EntityConstructor,
    forTable: boolean
  ) {
    const propertySchema &#x3D; entityType.schema.get(formField.id);
    formField.edit &#x3D;
      formField.edit ||
      this.entitySchemaService.getComponent(propertySchema, &quot;edit&quot;);
    formField.view &#x3D;
      formField.view ||
      this.entitySchemaService.getComponent(propertySchema, &quot;view&quot;);
    formField.tooltip &#x3D; formField.tooltip || propertySchema?.description;
    formField.additional &#x3D; formField.additional || propertySchema?.additional;
    if (forTable) {
      formField.forTable &#x3D; true;
      formField.label &#x3D;
        formField.label || propertySchema.labelShort || propertySchema.label;
    } else {
      formField.forTable &#x3D; false;
      formField.label &#x3D;
        formField.label || propertySchema.label || propertySchema.labelShort;
    }
    if (propertySchema?.validators) {
      formField.validators &#x3D; propertySchema?.validators;
    }
  }

  /**
   * Creates a FormGroups from the formFields and the existing values from the entity.
   * Missing fields in the formFields are filled with schema information.
   * @param formFields
   * @param entity
   * @param forTable
   */
  public createFormGroup&lt;T extends Entity&gt;(
    formFields: FormFieldConfig[],
    entity: T,
    forTable &#x3D; false
  ): EntityForm&lt;T&gt; {
    this.extendFormFieldConfig(formFields, entity.getConstructor(), forTable);
    const formConfig &#x3D; {};
    const entitySchema &#x3D; entity.getSchema();
    const copy &#x3D; entity.copy();
    formFields
      .filter((formField) &#x3D;&gt; entitySchema.get(formField.id))
      .forEach((formField) &#x3D;&gt; {
        const schema &#x3D; entitySchema.get(formField.id);
        let val &#x3D; copy[formField.id];
        if (
          entity.isNew &amp;&amp;
          schema.defaultValue &amp;&amp;
          (!val || (val as []).length &#x3D;&#x3D;&#x3D; 0)
        ) {
          val &#x3D; this.getDefaultValue(schema);
        }
        formConfig[formField.id] &#x3D; [val];
        if (formField.validators) {
          const validators &#x3D; this.dynamicValidator.buildValidators(
            formField.validators
          );
          formConfig[formField.id].push(validators);
        }
      });
    const group &#x3D; this.fb.group&lt;Partial&lt;T&gt;&gt;(formConfig);
    const sub &#x3D; group.valueChanges.subscribe(
      () &#x3D;&gt; (this.unsavedChanges.pending &#x3D; group.dirty)
    );
    this.subscriptions.push(sub);
    return group;
  }

  private getDefaultValue&lt;T&gt;(schema: EntitySchemaField) {
    let newVal;
    switch (schema.defaultValue) {
      case PLACEHOLDERS.NOW:
        newVal &#x3D; new Date();
        break;
      case PLACEHOLDERS.CURRENT_USER:
        newVal &#x3D; this.session.getCurrentUser().name;
        break;
      default:
        newVal &#x3D; schema.defaultValue;
    }
    if (isArrayDataType(schema.dataType)) {
      newVal &#x3D; [newVal];
    }
    return newVal;
  }

  /**
   * This function applies the changes of the formGroup to the entity.
   * If the form is invalid or the entity does not pass validation after applying the changes, an error will be thrown.
   * The input entity will not be modified but a copy of it will be returned in case of success.
   * @param form The formGroup holding the changes
   * @param entity The entity on which the changes should be applied.
   * @returns a copy of the input entity with the changes from the form group
   */
  public async saveChanges&lt;T extends Entity&gt;(
    form: EntityForm&lt;T&gt;,
    entity: T
  ): Promise&lt;T&gt; {
    this.checkFormValidity(form);
    const updatedEntity &#x3D; entity.copy() as T;
    Object.assign(updatedEntity, form.getRawValue());
    updatedEntity.assertValid();
    if (!this.canSave(entity, updatedEntity)) {
      throw new Error(
        $localize&#x60;Current user is not permitted to save these changes&#x60;
      );
    }

    return this.entityMapper
      .save(updatedEntity)
      .then(() &#x3D;&gt; {
        this.unsavedChanges.pending &#x3D; false;
        return Object.assign(entity, updatedEntity);
      })
      .catch((err) &#x3D;&gt; {
        throw new Error($localize&#x60;Could not save ${entity.getType()}\: ${err}&#x60;);
      });
  }

  private checkFormValidity&lt;T extends Entity&gt;(form: EntityForm&lt;T&gt;) {
    // errors regarding invalid fields wont be displayed unless marked as touched
    form.markAllAsTouched();
    if (form.invalid) {
      throw new InvalidFormFieldError();
    }
  }

  private canSave(oldEntity: Entity, newEntity: Entity): boolean {
    if (oldEntity.isNew) {
      return this.ability.can(&quot;create&quot;, newEntity);
    } else {
      return this.ability.can(&quot;update&quot;, oldEntity);
    }
  }

  resetForm&lt;E extends Entity&gt;(form: EntityForm&lt;E&gt;, entity: E) {
    // Patch form with values from the entity
    form.patchValue(entity as any);
    // Clear values that are not yet present on the entity
    const newKeys &#x3D; Object.keys(omit(form.controls, Object.keys(entity)));
    newKeys.forEach((key) &#x3D;&gt; form.get(key).setValue(null));
    form.markAsPristine();
    this.unsavedChanges.pending &#x3D; false;
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'EntityFormService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
